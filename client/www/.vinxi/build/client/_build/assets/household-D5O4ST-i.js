import{r as n,j as e,u as p}from"./client-oEds41LK.js";import{c as v,a as z,B as u}from"./button-D2Gc-Tkd.js";import{u as j,D as A,a as L,b as I,c as D,d as T,I as R,f as C}from"./input-DpMdAE7i.js";import{d as Y,c as g,j as W,i as M}from"./mutation-BZFfKvOs.js";import{c as y}from"./utils-B7BGwIMI.js";import{t as X,k as x,O as Z,z as h,l as N,q as w,u as b}from"./getAllCategories-BHeGl718.js";import{g as ee,u as se}from"./useAppData-ClLZv9oG.js";import{u as ae}from"./index.esm-ZVTjRAfO.js";import{H as te}from"./house-DsxACciB.js";import"./getCurrentLoggedInUser-DPzxe7eQ.js";import"./getAllIngredients-Bz8TcYMr.js";import"./getLatestGrocerylistByHouseholdId-Dk3ckNDT.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=v("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=v("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=v("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var H="Avatar",[re,Re]=Y(H),[ne,_]=re(H),P=n.forwardRef((s,a)=>{const{__scopeAvatar:t,...o}=s,[r,i]=n.useState("idle");return e.jsx(ne,{scope:t,imageLoadingStatus:r,onImageLoadingStatusChange:i,children:e.jsx(g.span,{...o,ref:a})})});P.displayName=H;var U="AvatarImage",E=n.forwardRef((s,a)=>{const{__scopeAvatar:t,src:o,onLoadingStatusChange:r=()=>{},...i}=s,c=_(U,t),l=ie(o,i.referrerPolicy),m=W(f=>{r(f),c.onImageLoadingStatusChange(f)});return M(()=>{l!=="idle"&&m(l)},[l,m]),l==="loaded"?e.jsx(g.img,{...i,ref:a,src:o}):null});E.displayName=U;var F="AvatarFallback",O=n.forwardRef((s,a)=>{const{__scopeAvatar:t,delayMs:o,...r}=s,i=_(F,t),[c,l]=n.useState(o===void 0);return n.useEffect(()=>{if(o!==void 0){const m=window.setTimeout(()=>l(!0),o);return()=>window.clearTimeout(m)}},[o]),c&&i.imageLoadingStatus!=="loaded"?e.jsx(g.span,{...r,ref:a}):null});O.displayName=F;function ie(s,a){const[t,o]=n.useState("idle");return M(()=>{if(!s){o("error");return}let r=!0;const i=new window.Image,c=l=>()=>{r&&o(l)};return o("loading"),i.onload=c("loaded"),i.onerror=c("error"),i.src=s,a&&(i.referrerPolicy=a),()=>{r=!1}},[s,a]),t}var q=P,B=E,J=O;const K=n.forwardRef(({className:s,...a},t)=>e.jsx(q,{ref:t,className:y("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));K.displayName=q.displayName;const le=n.forwardRef(({className:s,...a},t)=>e.jsx(B,{ref:t,className:y("aspect-square h-full w-full",s),...a}));le.displayName=B.displayName;const Q=n.forwardRef(({className:s,...a},t)=>e.jsx(J,{ref:t,className:y("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));Q.displayName=J.displayName;function de(){const{getToken:s}=p(),a=s({template:"1_HOUR"}).then(t=>t?.toString());return X({queryKey:x.currentUserHouseholdDetails,queryFn:async()=>{const t=await ee(await a);return t.data?t.data:null},enabled:!!a,staleTime:Z})}h.object({householdId:h.string()});async function ce({householdId:s,accessToken:a}){return await N(w.joinHousehold(),"POST",{householdId:s},{accessToken:a})}function ue(){const s=b(),{getToken:a}=p();return j({mutationKey:["join-household"],mutationFn:async({householdId:t})=>{const o=await a({template:"1_HOUR"}).then(r=>r?.toString());return ce({householdId:t,accessToken:o})},onSuccess:()=>{s.invalidateQueries(x.currentUserHouseholdDetails)}})}async function he({accessToken:s}){return await N(w.leaveHousehold(),"POST",void 0,{accessToken:s})}function me(){const s=b(),{getToken:a}=p();return j({mutationKey:["leave-household"],mutationFn:async()=>{const t=await a({template:"1_HOUR"}).then(o=>o?.toString());return he({accessToken:t})},onSuccess:()=>{s.invalidateQueries([...x.currentUserHouseholdDetails,...x.latestGrocerylistByUserId,...x.latestGrocerylistByHouseholdId])}})}h.object({id:h.string(),createdBy:h.string(),createdAt:h.string(),active:h.boolean()});async function xe({accessToken:s}){return await N(w.households(),"POST",void 0,{accessToken:s})}function fe(){const s=b(),{getToken:a}=p();return j({mutationKey:["create-household"],mutationFn:async()=>{const t=await a({template:"1_HOUR"}).then(o=>o?.toString());return xe({accessToken:t})},onSuccess:()=>{s.invalidateQueries(x.currentUserHouseholdDetails)}})}function pe(){const[s,a]=n.useState(null),t=n.useCallback(async o=>{if(!navigator?.clipboard)return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(o),a(o),!0}catch(r){return console.warn("Copy failed",r),a(null),!1}},[]);return[s,t]}var ge="Label",$=n.forwardRef((s,a)=>e.jsx(g.label,{...s,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(s.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));$.displayName=ge;var G=$;const ye=z("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),V=n.forwardRef(({className:s,...a},t)=>e.jsx(G,{ref:t,className:y(ye(),s),...a}));V.displayName=G.displayName;function ve({trigger:s,onSubmit:a}){const{handleSubmit:t,register:o,formState:r}=ae();return e.jsxs(A,{children:[e.jsx(L,{asChild:!0,children:s}),e.jsxs(I,{children:[e.jsx(D,{children:e.jsx(T,{children:"Join an Existing Household"})}),e.jsxs("form",{onSubmit:t(a),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"household-id",children:"Household ID"}),e.jsx(R,{id:"household-id",...o("householdId"),placeholder:"Enter household ID",required:!0}),r.errors.householdId&&e.jsx("p",{className:"text-sm text-red-500",children:"Please enter a valid Household ID"})]}),e.jsx(u,{type:"submit",className:"w-full",children:"Join Household"})]})]})]})}function je(){const{data:s}=de(),a=fe(),t=ue(),o=me(),[r,i]=pe(),[c,l]=n.useState(!1),m=async d=>{await t.mutateAsync({householdId:d.householdId})},f=async()=>{i(s.id).catch(d=>{console.error("Failed to copy!",d)}),l(!0),setTimeout(()=>l(!1),2e3)};return!s||!s?.id?e.jsxs("div",{className:" mx-auto max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-1",children:"My Household"}),e.jsx("h4",{className:"text-md text-center mb-4 self-center px-4 text-gray-500",children:"Get started by creating a household or join an existing one. When part of a household you can share a grocery list with other members."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(u,{className:"w-full",onClick:()=>a.mutateAsync(),isLoading:a.isPending,children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," Create Household"]}),e.jsx(ve,{trigger:e.jsxs(u,{variant:"outline",className:"w-full",children:[e.jsx(k,{className:"mr-2 h-4 w-4"})," Join Household"]}),onSubmit:m})]})]}):e.jsx("div",{className:"bg-white p-4 md:p-0 rounded-lg md:rounded-0 mx-2 md:mx-0",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"My Household"}),e.jsxs(A,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(u,{variant:"destructive",isLoading:o.isPending,children:[e.jsx(S,{className:"mr-2 h-4 w-4"})," Leave"]})}),e.jsxs(I,{children:[e.jsx(D,{children:e.jsx(T,{children:"Leave Household"})}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-8",children:e.jsx("h2",{className:"text-sm mb-2",children:"Are you sure you want to leave your household?"})}),e.jsxs("div",{className:"w-full flex justify-end gap-2 items-center",children:[e.jsx(C,{children:e.jsx(u,{variant:"outline",children:"No, Cancel"})}),e.jsx(C,{children:e.jsxs(u,{variant:"destructive",onClick:()=>o.mutateAsync(),isLoading:o.isPending,children:[e.jsx(S,{className:"mr-2 h-4 w-4"})," Yes, Leave"]})})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Members"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:s.members.map(d=>e.jsxs("div",{className:"flex items-center space-x-3 bg-gray-50 p-3 rounded-md",children:[e.jsx(K,{children:e.jsxs(Q,{children:[d.firstname[0],d.lastname[0]]})}),e.jsxs("span",{className:"font-medium",children:[d.firstname," ",d.lastname]})]},d.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Invite New Members"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx(R,{value:s.id,readOnly:!0,className:"flex-grow"}),e.jsxs(u,{variant:"outline",onClick:f,children:[c?e.jsx(k,{className:"mr-2 h-4 w-4"}):e.jsx(oe,{className:"mr-2 h-4 w-4"}),r?"Copied!":"Copy"]})]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Share this ID with others to invite them to your household."})]})]})})}const Me=()=>{const{isLoading:s}=se();return s?e.jsx("div",{children:"Loading..."}):e.jsx(je,{})};export{Me as component};
