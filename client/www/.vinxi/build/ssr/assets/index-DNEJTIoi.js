import{jsx as e,jsxs as s,Fragment as j}from"react/jsx-runtime";import*as L from"react";import{useState as b,useMemo as q,useEffect as W}from"react";import*as w from"@radix-ui/react-tabs";import{c as k}from"./utils-bhneXptQ.js";import*as _ from"@radix-ui/react-checkbox";import{Check as K,Filter as X,FilterXIcon as z,Pencil as O,Loader2 as V,ClipboardList as Y,Calendar as J,User as Z,House as ee}from"lucide-react";import{C,a as te,b as I,S as se}from"./card-C2TxHGvX.js";import{B as p}from"./button-DZIqpug3.js";import{I as ae,D as ie,a as re,b as ne,c as le,d as oe,e as ce,f as de}from"./input-DPMfAGGT.js";import{u as me,a as he}from"./useLatestGrocerylistByHouseholdId-BJ0_MOz6.js";import{useQueryClient as H,useMutation as A}from"@tanstack/react-query";import{h as F,a as R,k as d}from"./getAllCategories-f73zdoR0.js";import{useAuth as M}from"@clerk/tanstack-start";import{z as U}from"zod";import{u as ue,a as pe}from"./useCategories-BU-wEToM.js";import{u as ge}from"./useGetCurrentLoggedInUser-BaYIIjoZ.js";import{D as fe,a as ye,b as Ne,d as ve}from"./dropdown-menu-CXlQBPJa.js";import{S as m}from"./skeleton-B3DVyw4A.js";import{useNavigate as T}from"@tanstack/react-router";import"clsx";import"tailwind-merge";import"@radix-ui/react-scroll-area";import"@radix-ui/react-slot";import"class-variance-authority";import"@radix-ui/react-dialog";import"./getLatestGrocerylistByHouseholdId-edhHmGoA.js";import"axios";import"./getCurrentLoggedInUser-BSklaDhP.js";import"@radix-ui/react-dropdown-menu";const we=w.Root,E=L.forwardRef(({className:t,...i},r)=>e(w.List,{ref:r,className:k("md:max-w-[560px] inline-flex items-center justify-center md:gap-2 rounded-t-xl md:rounded-lg bg-background md:bg-white p-3 md:p-0 text-muted-foreground",t),...i}));E.displayName=w.List.displayName;const D=L.forwardRef(({className:t,...i},r)=>e(w.Trigger,{ref:r,className:k("md:max-w-[280px] bg-white inline-flex items-center justify-center whitespace-nowrap rounded-lg md:rounded-md px-3 py-3 text-xs md:text-sm ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white dark:data-[state=active]:bg-white data-[state=active]:text-foreground data-[state=active]:shadow-sm md:data-[state=active]:shadow-none md:data-[state=active]:border-[1px] md:data-[state=active]:border-solid md:data-[state=active]:border-divider ",t),...i}));D.displayName=w.Trigger.displayName;const G=L.forwardRef(({className:t,...i},r)=>e(w.Content,{ref:r,className:k("mt-0 md:mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...i}));G.displayName=w.Content.displayName;const Q=L.forwardRef(({className:t,...i},r)=>e(_.Root,{ref:r,className:k("peer h-6 w-6 shrink-0 rounded-sm border border-grey ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...i,children:e(_.Indicator,{className:k("flex items-center justify-center text-current"),children:e(K,{className:"h-6 w-6"})})}));Q.displayName=_.Root.displayName;async function P({itemId:t,accessToken:i}){return await F(R.checkItem(t),"POST",void 0,{accessToken:i})}function be(){const t=H(),{getToken:i}=M();return A({mutationKey:d.checkItem,mutationFn:async r=>{const n=await i({template:"1_HOUR"}).then(l=>l?.toString());return P({itemId:r,accessToken:n})},onMutate:async r=>{await t.cancelQueries(d.latestGrocerylistByUserId);const n=t.getQueryData(d.latestGrocerylistByUserId);return n&&n.items&&t.setQueryData(d.latestGrocerylistByUserId,{...n,items:n.items.map(l=>l.item_id===r?{...l,check:!l.check}:l)}),{prev:n}},onSuccess:()=>{t.invalidateQueries([...d.latestGrocerylistByUserId,...d.latestGrocerylistByHouseholdId])}})}function xe(){const t=H(),{getToken:i}=M();return A({mutationKey:d.checkItem,mutationFn:async r=>{const n=await i({template:"1_HOUR"}).then(l=>l?.toString());return P({itemId:r,accessToken:n})},onMutate:async r=>{await t.cancelQueries(d.latestGrocerylistByHouseholdId);const n=t.getQueryData(d.latestGrocerylistByHouseholdId);return n&&n.items&&t.setQueryData(d.latestGrocerylistByHouseholdId,{...n,items:n.items.map(l=>l.item_id===r?{...l,check:!l.check}:l)}),{prev:n}},onSuccess:()=>{t.invalidateQueries([...d.latestGrocerylistByUserId,...d.latestGrocerylistByHouseholdId])}})}U.object({household:U.boolean(),menu:U.boolean()});async function ke({data:t,accessToken:i}){return await F(R.createList(),"POST",t,{accessToken:i})}function Ce(){const t=H(),{getToken:i}=M();return A({mutationKey:d.createList,mutationFn:async r=>{const n=await i({template:"1_HOUR"}).then(l=>l?.toString());return ke({data:r,accessToken:n})},onSuccess:()=>{t.invalidateQueries([...d.latestGrocerylistByUserId,...d.latestGrocerylistByHouseholdId])}})}function B({id:t,items:i,onCheckOrUncheckItem:r,categories:n,isLoading:l}){const[g,y]=b(""),[N,x]=b(i),[f,v]=b(null),o=T(),c=q(()=>{const a=N?.reduce((h,u)=>(h[u.name]=(h[u.name]||0)+1,h),{});return N?.reduce((h,u)=>(h.some(S=>S.name===u.name)||h.push({...u,quantity:a[u.name]}),h),[])},[N,i]);return W(()=>{i&&Array.isArray(i)&&x(i)},[i]),e("div",{className:"bg-slate-100 md:bg-white",children:s(se,{className:"bg-background md:bg-white px-3 py-3 rounded-b-sm h-fit md:rounded-lg",children:[c?.length?e("div",{className:"bg-white rounded-lg border-slate-200 border-[1px] p-3 mb-3",children:s("div",{className:"flex justify-between",children:[e("div",{children:e(ae,{placeholder:"Search items...",value:g,onChange:a=>y(a.target.value)})}),s("div",{className:"flex items-center gap-2",children:[s("div",{className:`flex items-center pl-2 rounded-md gap-1 ${f?"border-[1px] border-slate-200":""}`,children:[n.find(a=>a.id===f)?.name,s(fe,{children:[e(ye,{children:e("div",{children:e(X,{})})}),e(Ne,{className:"px-2",align:"end",children:n.map(a=>e(ve,{className:"p-2",children:e("div",{className:"flex gap-1 hover:bg-gray-50 w-full",onClick:()=>v(a.id),children:a.name})},a.id))})]})]}),e(p,{onClick:()=>{y(""),v(null)},variant:"ghost",disabled:!f,children:e(z,{})})]})]})}):null,s("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[!c?.length&&s("div",{className:"flex flex-col gap-2 justify-center items-center bg-white rounded-lg p-3 md:p-4 md:rounded-xl col-span-2",children:[e("span",{className:"text-center text-muted-foreground",children:"You have no items in your current list."}),e(p,{onClick:()=>{t&&o({to:`/lists/${t}`})},className:"mt-2",variant:"outline",children:"Add items"})]}),c&&c.filter(a=>f!==null?a.category_id===f:!0).filter(a=>a.name.toLowerCase().includes(g.toLowerCase())).map(a=>e(C,{children:s(I,{className:"flex items-center justify-between p-4 gap-2",children:[e("div",{className:"flex items-center justify-center w-8 h-8",children:e(Q,{id:a.item_id,checked:a.check,onCheckedChange:()=>r(a.item_id),className:"w-6 h-6 border-2 border-primary"})}),e("label",{htmlFor:a.item_id,className:`flex-grow text-base font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${a.check?"line-through text-muted-foreground":""}`,children:a.name}),a.quantity>1&&s("span",{className:"text-md font-semibold text-muted-foreground",children:["x",a.quantity]})]})},a.item_id)),l?e(j,{children:[...Array(3)].map((a,h)=>e(C,{children:e(I,{className:"p-6 px-7",children:s("div",{className:"flex justify-between items-center",children:[s("div",{className:"flex items-center space-x-2",children:[e(m,{className:"h-6 w-6 rounded-sm"}),e(m,{className:"h-6 w-24"})]}),e(m,{className:"h-6 w-12"})]})})},h))}):null]})]})})}const $=({children:t})=>e(C,{className:"w-full p-4 md:rounded-lg h-fit md:mt-3",children:e(I,{className:"w-full md:p-0 rounded-lg",children:t})});function Ie({list:t}){const i=T();return s($,{children:[s("div",{className:"w-full flex justify-between items-center",children:[e("h3",{className:"text-md md:text-lg font-semibold",children:"My Shopping List"}),t?.id&&s(p,{variant:"outline",onClick:()=>i({to:`/lists/${t.id}`}),children:[e(O,{className:"mr-2 h-4 w-4"}),"Edit"]})]}),t.items?.length?s("p",{className:"text-sm",children:["Total Items: ",t.items?.length??"0"]}):null,t.items?.length?s("p",{className:"text-sm",children:["Checked Items: ",t.items?.filter(r=>r.check)?.length??"0"]}):null]})}function Le({list:t}){const i=T();return s($,{children:[s("div",{className:"w-full flex justify-between items-center",children:[e("h3",{className:"text-md md:text-lg font-semibold",children:"My Household Shopping List"}),t?.id&&s(p,{variant:"outline",onClick:()=>i({to:`/lists/${t.id}`}),children:[e(O,{className:"mr-2 h-4 w-4"}),"Edit"]})]}),t.items?.length?s("p",{className:"text-sm",children:["Total Items: ",t.items?.length??"0"]}):null,t.items?.length?s("p",{className:"text-sm",children:["Checked Items: ",t.items?.filter(r=>r.check)?.length??"0"]}):null]})}function Te(){const t=T(),[i,r]=b(!1),[n,l]=b("type"),[g,y]=b(null),N=Ce(),{toast:x}=pe(),{data:f}=ge(),v=async a=>{if(!g)return;r(!0);const h={household:a==="household",menu:g==="mealplan"},u=await N.mutateAsync(h);if(!u.ok||!u.data){x({variant:"destructive",title:"Error",description:"Something went wrong creating the list."}),r(!1);return}const S={shopping:{me:`/lists/${u.data.data}`,household:`/lists/${u.data.data}`},mealplan:{me:"/lists/mealplan/new",household:"/list/mealplan/new?householdId=id"}};t({to:`${S[g][a]}`})},o=()=>{l("type"),y(null)},c="flex-1 h-16 text-lg transition-all duration-200 ease-in-out hover:bg-primary/10 hover:border-primary hover:border-2 active:bg-primary/20 active:scale-95";return s(ie,{onOpenChange:a=>!a&&o(),children:[e(re,{asChild:!0,children:s(p,{className:`fixed bottom-6 right-6 md:static md:w-auto md:h-auto md:rounded-md
                     w-16 h-16 rounded-full bg-primary text-primary-foreground shadow-lg md:shadow-none
                     hover:bg-primary/90 transition-all duration-200 ease-in-out
                     flex items-center justify-center z-50`,children:[e("span",{className:"text-3xl md:hidden",children:"+"}),e("span",{className:"hidden md:inline",children:"Create List"})]})}),s(ne,{className:"sm:max-w-[425px] bg-white",children:[s(le,{children:[e(oe,{className:"text-center mb-4",children:"Create a New List"}),!i&&e(ce,{className:"text-center",children:n==="type"?"Select the type of list you want to create.":"Choose who this list is for."})]}),i&&s("div",{className:"flex flex-col gap-2 justify-center items-center",children:[e(V,{className:"h-6 w-6 animate-spin"}),e("span",{children:"Creating new list..."})]}),!i&&s(j,{children:[n==="type"?s("div",{className:"flex flex-col gap-4",children:[s(p,{onClick:()=>{y("shopping"),l("scope")},className:c,variant:"outline",children:[e(Y,{className:"mr-2 h-6 w-6"}),"Shopping List"]}),s(p,{onClick:()=>{y("mealplan"),l("scope")},className:c,variant:"outline",disabled:process.env.NEXT_PUBLIC_FLAG_FEATURE_MEALPLANS!=="true",children:[e(J,{className:"mr-2 h-6 w-6"}),"Mealplan List ",process.env.NEXT_PUBLIC_FLAG_FEATURE_MEALPLANS!=="true"&&"(Coming Soon)"]})]}):s("div",{className:"flex flex-col gap-4",children:[s(p,{onClick:()=>v("me"),className:c,variant:"outline",children:[e(Z,{className:"mr-2 h-6 w-6"}),"For Me"]}),f?.householdId&&s(p,{onClick:()=>v("household"),className:c,variant:"outline",children:[e(ee,{className:"mr-2 h-6 w-6"}),"For Household"]})]}),n==="scope"?e(p,{onClick:()=>l("type"),variant:"outline",className:"mt-4",children:"Back"}):e(de,{className:"w-full mt-4",children:e(p,{variant:"outline",className:"w-full",children:"Cancel"})})]})]})]})}function Se(){const{data:t,isFetching:i}=me({initialData:null}),{data:r,isLoading:n}=he({initialData:null}),{data:l}=ue(),g=be(),y=xe(),N=o=>{const c=t.items.find(a=>a.item_id===o);for(const a of t.items)a.item_id!==o&&a.name===c?.name&&g.mutateAsync(a.item_id)},x=o=>{const c=r.items.find(a=>a.item_id===o);for(const a of r.items)a.item_id!==o&&a.name===c?.name&&g.mutateAsync(a.item_id)},f=o=>{g.mutateAsync(o),N(o)},v=o=>{y.mutateAsync(o),x(o)};return i&&!t?s("div",{className:"container mx-auto p-4 space-y-4",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{className:"space-x-2",children:[e(m,{className:"h-10 w-32 inline-block"}),e(m,{className:"h-10 w-40 inline-block"})]}),e(m,{className:"h-10 w-24"})]}),e(C,{children:s(te,{children:[e(m,{className:"h-6 w-40 mb-2"}),s("div",{className:"space-y-2",children:[e(m,{className:"h-4 w-48"}),e(m,{className:"h-4 w-32"}),e(m,{className:"h-4 w-40"})]})]})}),e(m,{className:"h-10 w-full"}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[...Array(5)].map((o,c)=>e(C,{children:e(I,{className:"p-4",children:s("div",{className:"flex justify-between items-center",children:[s("div",{className:"flex items-center space-x-2",children:[e(m,{className:"h-4 w-4 rounded-sm"}),e(m,{className:"h-4 w-24"})]}),e(m,{className:"h-4 w-8"})]})})},c))})]}):e("div",{className:"space-y-4",children:s(we,{defaultValue:"my",className:"w-full",children:[s("div",{className:"w-full flex justify-between md:px-3 md:mt-3",children:[s(E,{className:"grid w-full md:w-1/2 grid-cols-2",children:[e(D,{value:"my",children:"My Shopping List"}),r&&e(D,{value:"household",children:"Household Shopping List"})]}),e(Te,{})]}),s("div",{className:"lg:pt-2",children:[e(G,{value:"my",children:s("div",{className:"w-full grid grid-cols-1 md:grid-cols-1 md:gap-4",children:[e("div",{className:"px-3",children:e(Ie,{list:t})}),e(B,{id:t?.id,items:t?.items,onCheckOrUncheckItem:f,categories:l??[],isLoading:i})]})}),r&&e(G,{value:"household",children:s("div",{className:"w-full grid grid-cols-1 md:grid-cols-1 md:gap-4",children:[e("div",{className:"px-3",children:e(Le,{list:r})}),e(B,{id:r?.id,items:r?.items,onCheckOrUncheckItem:v,categories:l??[],isLoading:n})]})})]})]})})}const st=()=>e("div",{className:"w-full min-h-[50vh]",children:e(Se,{})});export{st as component};
