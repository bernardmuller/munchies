import{jsx as t,jsxs as o,Fragment as b}from"react/jsx-runtime";import{useNavigate as j}from"@tanstack/react-router";import z,{useState as H,useMemo as L}from"react";import{ChevronLeft as P,Minus as U,Trash as K,Plus as S}from"lucide-react";import{B as h}from"./button-DZIqpug3.js";import{S as k,C as N,b as v}from"./card-C2TxHGvX.js";import{useQuery as V,useQueryClient as G,useMutation as W}from"@tanstack/react-query";import{h as B,a as T,k as l,O as Y}from"./getAllCategories-f73zdoR0.js";import{useAuth as _}from"@clerk/tanstack-start";import{a as $,u as J,N as X}from"./NewIngredientForm-Bb__oI23.js";import{a as D,u as Z}from"./useCategories-BU-wEToM.js";import ee from"react-select";import te from"react-select/creatable";import{D as ne,b as re,c as ae,d as ie}from"./input-DPMfAGGT.js";import{S as w}from"./skeleton-B3DVyw4A.js";import{R as se}from"./ssr-YHP4nufS.js";import"@radix-ui/react-slot";import"class-variance-authority";import"./utils-bhneXptQ.js";import"clsx";import"tailwind-merge";import"@radix-ui/react-scroll-area";import"axios";import"zod";import"./getAllIngredients-6sXcg4a7.js";import"react-hook-form";import"@hookform/resolvers/zod";import"@radix-ui/react-dialog";import"h3";import"node:async_hooks";import"node:stream";import"react-dom/server";import"@clerk/tanstack-start/server";import"@tanstack/router-devtools";import"react-dom";async function oe(r,i){return await B(T.getGrocerylistById(i),"GET",void 0,{accessToken:r})}function le({id:r}){const{getToken:i}=_(),u=i({template:"1_HOUR"}).then(s=>s?.toString());return V({queryKey:l.getGrocerylistById(r),queryFn:async()=>{const s=await oe(await u,r);return s.data?s.data:null},enabled:!!u,staleTime:Y})}async function ce({id:r,accessToken:i}){return await B(T.deleteItem(r),"DELETE",void 0,{accessToken:i})}function me(r){const i=G(),{getToken:u}=_();return D(),W({mutationKey:["delete-item"],mutationFn:async s=>{const n=await u({template:"1_HOUR"}).then(c=>c?.toString());return ce({id:s,accessToken:n})},onMutate:async s=>{await i.cancelQueries([...l.latestGrocerylistByUserId,...l.latestGrocerylistByHouseholdId,...l.getGrocerylistById(r)]);const n=await i.getQueryData(l.getGrocerylistById(r));return i.setQueryData(l.getGrocerylistById(r),{...n,items:n.items.filter(c=>c.item_id!==s)}),{prev:n}},onSuccess:()=>{i.invalidateQueries([...l.latestGrocerylistByUserId,...l.latestGrocerylistByHouseholdId,...l.getGrocerylistById(r)])}})}const de=({options:r,onSelect:i,placeholder:u,onFocus:s})=>t(ee,{options:r.map(n=>({value:n.id,label:n.name})),placeholder:"Search ingredients...",onChange:n=>{const c=r.find(p=>p.id===n.value);n&&n.value&&c&&i(c)},onFocus:s,className:"my-react-select-container",classNamePrefix:"my-react-select"});function ue(){const{listId:r}=se.useParams(),i=j({from:"/lists/$listId"}),[u,s]=z.useState(!1),{data:n,isFetching:c}=le({id:r}),{data:p}=Z(),q=G(),F=$(r),I=me(r),[x,f]=H(""),{data:m,isFetching:R}=J(),{toast:C}=D(),y=L(()=>{if(!n)return[];const e=n.items.reduce((a,d)=>(a[d.name]=(a[d.name]||0)+1,a),{});return n.items.reduce((a,d)=>(a.some(M=>M.name===d.name)||a.push({...d,quantity:e[d.name]}),a),[])},[n]),g=async e=>{if(!e){C({variant:"destructive",title:"Error",description:"Ingredient Id not found."});return}const a=m?.find(d=>d.id===e);if(!a){C({variant:"destructive",title:"Error",description:"Ingredient not found."});return}await F.mutateAsync({...a,ingredientId:a.id})},Q=async e=>{I.mutate(e)},A=e=>{if(n)for(const a of n.items)a.ingredient_id===e&&I.mutate(a.item_id)},E=e=>{s(!0),f(e)},O=()=>{const e=document.querySelector(".page");e&&window.scrollTo({top:e.offsetTop,behavior:"smooth"})};return o(b,{children:[t(ne,{open:u,onOpenChange:s,children:o(re,{className:"sm:max-w-[425px] bg-white",children:[t(ae,{children:t(ie,{className:"text-center mb-4",children:"New Ingredient"})}),t(X,{defaultValue:x,categories:p?.length?p:[],onClose:()=>s(!1),onInvalidate:()=>{q.invalidateQueries(l.ingredients)}})]})}),o("div",{className:"container mx-auto p-4",children:[o(h,{variant:"outline",onClick:()=>i({to:"/lists"}),className:"mb-4",children:[t(P,{className:"mr-2 h-4 w-4"}),"Back"]}),o("div",{className:"flex flex-col md:flex-row gap-4 min-h-[100vh]",children:[o("div",{className:"w-full md:w-1/2",children:[t("h2",{className:"text-xl font-semibold mb-2",children:"Current Grocery List"}),t("div",{className:"md:hidden mb-4 page",children:t(de,{options:m&&m.length?m:[],onSelect:e=>g(e.id),placeholder:"Search and add ingredients...",onFocus:O})}),t(k,{className:"min-h-[75vh]",children:o("div",{className:"space-y-2",children:[!y.length&&!R&&t("span",{className:"text-center text-muted-foreground",children:"No items in list."}),c&&!y.length?t(b,{children:[...Array(3)].map((e,a)=>t(N,{children:t(v,{className:"p-6 px-7",children:o("div",{className:"flex justify-between items-center",children:[o("div",{className:"flex items-center space-x-2",children:[t(w,{className:"h-6 w-6 rounded-sm"}),t(w,{className:"h-6 w-24"})]}),t(w,{className:"h-6 w-12"})]})})},a))}):null,y.map(e=>t(N,{children:o(v,{className:"flex items-center justify-between p-4",children:[t("span",{className:"flex-grow",children:e.name}),o("div",{className:"flex items-center space-x-2",children:[e.quantity>1?t(h,{variant:"outline",size:"icon",onClick:()=>Q(e.item_id),children:t(U,{className:"h-4 w-4"})}):t(h,{variant:"outline",size:"icon",onClick:()=>A(e.ingredient_id),children:t(K,{className:"h-4 w-4"})}),t("span",{className:"w-8 text-center",children:e.quantity||0}),t(h,{variant:"outline",size:"icon",onClick:()=>{g(e.ingredient_id)},children:t(S,{className:"h-4 w-4"})})]})]})},e.item_id))]})})]}),o("div",{className:"hidden md:block w-full md:w-1/2",children:[t("h2",{className:"text-xl font-semibold mb-2",children:"Available Items"}),t("div",{className:"mb-4 relative pr-4",children:t(te,{isClearable:!0,options:m?.map(e=>({value:e.id,label:e.name})),placeholder:"Search for an item...",onCreateOption:E,onChange:e=>{f(e?e.label.toString():"")},onInputChange:e=>f(e),menuShouldScrollIntoView:!0,className:"my-react-select-container",classNamePrefix:"my-react-select",styles:{input:e=>({...e,fontSize:"16px"}),control:e=>({...e,borderRadius:8,height:44}),indicatorSeparator:e=>({...e,display:"none"}),menu:e=>({...e,borderRadius:8})}})}),t(k,{className:"md:h-[calc(100vh-250px)] min-h-75vh]",children:t("div",{className:"space-y-2 pr-4",children:m&&m.length?m.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())).map(e=>t(N,{children:o(v,{className:"flex items-center justify-between p-4",children:[t("span",{className:"flex-grow",children:e.name}),t(h,{variant:"outline",size:"icon",onClick:()=>g(e.id),children:t(S,{className:"h-4 w-4"})})]})},e.id)):null})})]})]})]})]})}const We=()=>t(ue,{});export{We as component};
