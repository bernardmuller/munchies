import{useQuery as b,useQueryClient as f,useMutation as y}from"@tanstack/react-query";import{g as k}from"./getAllIngredients-6sXcg4a7.js";import{k as r,O as T,h as p,a as h}from"./getAllCategories-f73zdoR0.js";import{useAuth as u}from"@clerk/tanstack-start";import{z as c}from"zod";import{jsx as s,Fragment as B,jsxs as l}from"react/jsx-runtime";import{a as G}from"./useCategories-BU-wEToM.js";import{useForm as _}from"react-hook-form";import{zodResolver as C}from"@hookform/resolvers/zod";import{I as O}from"./input-DPMfAGGT.js";import Q from"react-select";import{B as j}from"./button-DZIqpug3.js";import{Loader2 as F}from"lucide-react";function $(){const{getToken:e}=u(),t=e({template:"1_HOUR"}).then(a=>a?.toString());return b({queryKey:r.ingredients,queryFn:async()=>{const a=await k(await t);return a.data?a.data:null},enabled:!!t,staleTime:T})}c.object({ingredientId:c.string()});async function R({grocerylistId:e,data:t,accessToken:a}){return await p(h.createGrocerylistItem(e),"POST",{ingredientId:t.ingredientId},{accessToken:a})}function ee(e){const t=f(),{getToken:a}=u();return y({mutationKey:r.createItem,mutationFn:async i=>{if(!e)return;const n=await a({template:"1_HOUR"}).then(m=>m?.toString());return R({data:i,grocerylistId:e,accessToken:n})},onMutate:async i=>{await t.cancelQueries([...r.latestGrocerylistByUserId,...r.latestGrocerylistByHouseholdId,...r.getGrocerylistById(e)]);const n=t.getQueryData(r.getGrocerylistById(e));return n&&n.items&&t.setQueryData(r.getGrocerylistById(e),{...n,items:n.items.concat({item_id:Math.random().toString(),check:!1,name:i.name,ingredient_id:i.ingredientId,category_id:i.categoryId})}),{prev:n}},onSuccess:()=>{t.invalidateQueries([...r.latestGrocerylistByUserId,...r.latestGrocerylistByHouseholdId,...r.getGrocerylistById(e)])}})}c.object({name:c.string(),categoryId:c.string()});async function q({data:e,accessToken:t}){return await p(h.ingredients(),"POST",e,{accessToken:t})}function H(){const e=f(),{getToken:t}=u();return y({mutationKey:r.createIngredient,mutationFn:async a=>{const i=await t({template:"1_HOUR"}).then(n=>n?.toString());return q({data:a,accessToken:i})},onSuccess:()=>{e.invalidateQueries(r.ingredients)}})}const P=c.object({name:c.string().min(2,{message:"Name must be at least 2 characters."}),categoryId:c.string()});function te({categories:e,onClose:t,onInvalidate:a,defaultValue:i}){const n=H(),{toast:m}=G(),{register:I,formState:{errors:g},handleSubmit:x,setValue:S,reset:N,getValues:d,clearErrors:w}=_({resolver:C(P),defaultValues:{name:i??"",categoryId:""}});return console.log(i),s(B,{children:l("form",{onSubmit:x(o=>{const v={name:o.name,categoryId:o.categoryId};n.mutate(v,{onSuccess:()=>{N(),t(),a(),m({variant:"success",title:"Success",description:"Ingredient created successfully"})}})}),children:[l("div",{className:"flex flex-col lg:flex-row gap-8  w-full min-h-[200px]",children:[s("div",{className:"w-full h-full xl:flex-[0.6] ",children:l("div",{className:"w-full flex flex-col gap-2",children:[l("div",{className:"w-full flex flex-col gap-2",children:[l("p",{children:["Name",s("span",{className:"text-red-400",children:"*"})]}),s(O,{placeholder:"eg. Cherry Tomatoes",defaultValue:d("name"),...I("name")}),s("span",{className:"text-red-500 text-sm py-1",children:g.name?.message})]}),l("div",{className:"w-full flex flex-col gap-2",children:[l("p",{children:["Category",s("span",{className:"text-red-400",children:"*"})]}),s(Q,{options:e?.map(o=>({value:String(o.id),label:o.name})),placeholder:"Select a category",value:{value:d("categoryId"),label:e?.find(o=>o.id===d("categoryId"))?.name},onChange:o=>{o&&(w("categoryId"),S("categoryId",String(o.value)))},className:"my-react-select-container",classNamePrefix:"my-react-select"}),s("span",{className:"text-red-500 text-sm py-1",children:g.categoryId?.message})]})]})}),s("div",{className:"w-full h-full lg:flex-[0.4] lg:pl-4 sm:pt-7 lg:pt-0"})]}),s("div",{className:"w-full flex gap-2 justify-end",children:l(j,{disabled:n.isPending,type:"submit",children:[n.isPending&&s(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit"]})})]})})}export{te as N,ee as a,$ as u};
