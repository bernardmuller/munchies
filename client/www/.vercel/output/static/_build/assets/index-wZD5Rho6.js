import{r as u,j as e,u as P,l as R}from"./client-oEds41LK.js";import{d as q,h as Q,u as je,c as C,e as T,f as K}from"./mutation-BZFfKvOs.js";import{g as V,h as be,I as Ne,u as ke,i as we,D as Ce,b as Ie,d as Te,f as Se}from"./dropdown-menu-BmGc5aOI.js";import{u as Le}from"./floating-ui.dom-AxQjRnNf.js";import{c as S}from"./utils-B7BGwIMI.js";import{c as _e,u as Re,B as b,L as De}from"./button-D2Gc-Tkd.js";import{C as L,a as Ee,b as _,S as Me}from"./card-BSQouIYW.js";import{u as G,I as Ae,D as Pe,a as Ge,b as Ue,c as Fe,d as He,e as Be,f as Oe}from"./input-DpMdAE7i.js";import{u as $e,a as qe,F as Qe,b as Ke}from"./useLatestGrocerylistByHouseholdId-JqKufENH.js";import{l as z,q as X,u as U,k as y,z as E}from"./getAllCategories-BHeGl718.js";import{u as Ve,a as ze}from"./useCategories-B1B_UBf3.js";import{u as Xe}from"./useGetCurrentLoggedInUser-TD5-7DA1.js";import{S as v}from"./skeleton-B0vMIt_L.js";import{C as We,a as Ye}from"./clipboard-list-Dgx1aeGg.js";import{U as Je}from"./user-_ufPmFvn.js";import{H as Ze}from"./house-DsxACciB.js";import"./getLatestGrocerylistByHouseholdId-Dk3ckNDT.js";import"./getCurrentLoggedInUser-DPzxe7eQ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=_e("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var F="Tabs",[es,Ps]=q(F,[V]),Y=V(),[ss,H]=es(F),J=u.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,onValueChange:i,defaultValue:c,orientation:l="horizontal",dir:h,activationMode:f="automatic",...x}=s,m=Le(h),[o,d]=Q({prop:n,onChange:i,defaultProp:c});return e.jsx(ss,{scope:a,baseId:je(),value:o,onValueChange:d,orientation:l,dir:m,activationMode:f,children:e.jsx(C.div,{dir:m,"data-orientation":l,...x,ref:t})})});J.displayName=F;var Z="TabsList",ee=u.forwardRef((s,t)=>{const{__scopeTabs:a,loop:n=!0,...i}=s,c=H(Z,a),l=Y(a);return e.jsx(be,{asChild:!0,...l,orientation:c.orientation,dir:c.dir,loop:n,children:e.jsx(C.div,{role:"tablist","aria-orientation":c.orientation,...i,ref:t})})});ee.displayName=Z;var se="TabsTrigger",te=u.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,disabled:i=!1,...c}=s,l=H(se,a),h=Y(a),f=re(l.baseId,n),x=ie(l.baseId,n),m=n===l.value;return e.jsx(Ne,{asChild:!0,...h,focusable:!i,active:m,children:e.jsx(C.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":x,"data-state":m?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:f,...c,ref:t,onMouseDown:T(s.onMouseDown,o=>{!i&&o.button===0&&o.ctrlKey===!1?l.onValueChange(n):o.preventDefault()}),onKeyDown:T(s.onKeyDown,o=>{[" ","Enter"].includes(o.key)&&l.onValueChange(n)}),onFocus:T(s.onFocus,()=>{const o=l.activationMode!=="manual";!m&&!i&&o&&l.onValueChange(n)})})})});te.displayName=se;var ae="TabsContent",ne=u.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,forceMount:i,children:c,...l}=s,h=H(ae,a),f=re(h.baseId,n),x=ie(h.baseId,n),m=n===h.value,o=u.useRef(m);return u.useEffect(()=>{const d=requestAnimationFrame(()=>o.current=!1);return()=>cancelAnimationFrame(d)},[]),e.jsx(K,{present:i||m,children:({present:d})=>e.jsx(C.div,{"data-state":m?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":f,hidden:!d,id:x,tabIndex:0,...l,ref:t,style:{...s.style,animationDuration:o.current?"0s":void 0},children:d&&c})})});ne.displayName=ae;function re(s,t){return`${s}-trigger-${t}`}function ie(s,t){return`${s}-content-${t}`}var ts=J,oe=ee,ce=te,le=ne;const as=ts,de=u.forwardRef(({className:s,...t},a)=>e.jsx(oe,{ref:a,className:S("md:max-w-[560px] inline-flex items-center justify-center md:gap-2 rounded-t-xl md:rounded-lg bg-background md:bg-white p-3 md:p-0 text-muted-foreground",s),...t}));de.displayName=oe.displayName;const M=u.forwardRef(({className:s,...t},a)=>e.jsx(ce,{ref:a,className:S("md:max-w-[280px] bg-white inline-flex items-center justify-center whitespace-nowrap rounded-lg md:rounded-md px-3 py-3 text-xs md:text-sm ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white dark:data-[state=active]:bg-white data-[state=active]:text-foreground data-[state=active]:shadow-sm md:data-[state=active]:shadow-none md:data-[state=active]:border-[1px] md:data-[state=active]:border-solid md:data-[state=active]:border-divider ",s),...t}));M.displayName=ce.displayName;const A=u.forwardRef(({className:s,...t},a)=>e.jsx(le,{ref:a,className:S("mt-0 md:mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));A.displayName=le.displayName;function ns(s){const t=u.useRef({value:s,previous:s});return u.useMemo(()=>(t.current.value!==s&&(t.current.previous=t.current.value,t.current.value=s),t.current.previous),[s])}var B="Checkbox",[rs,Gs]=q(B),[is,os]=rs(B),ue=u.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:n,checked:i,defaultChecked:c,required:l,disabled:h,value:f="on",onCheckedChange:x,form:m,...o}=s,[d,r]=u.useState(null),p=Re(t,j=>r(j)),g=u.useRef(!1),k=d?m||!!d.closest("form"):!0,[w=!1,D]=Q({prop:i,defaultProp:c,onChange:x}),ve=u.useRef(w);return u.useEffect(()=>{const j=d?.form;if(j){const I=()=>D(ve.current);return j.addEventListener("reset",I),()=>j.removeEventListener("reset",I)}},[d,D]),e.jsxs(is,{scope:a,state:w,disabled:h,children:[e.jsx(C.button,{type:"button",role:"checkbox","aria-checked":N(w)?"mixed":w,"aria-required":l,"data-state":xe(w),"data-disabled":h?"":void 0,disabled:h,value:f,...o,ref:p,onKeyDown:T(s.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:T(s.onClick,j=>{D(I=>N(I)?!0:!I),k&&(g.current=j.isPropagationStopped(),g.current||j.stopPropagation())})}),k&&e.jsx(cs,{control:d,bubbles:!g.current,name:n,value:f,checked:w,required:l,disabled:h,form:m,style:{transform:"translateX(-100%)"},defaultChecked:N(c)?!1:c})]})});ue.displayName=B;var me="CheckboxIndicator",he=u.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:n,...i}=s,c=os(me,a);return e.jsx(K,{present:n||N(c.state)||c.state===!0,children:e.jsx(C.span,{"data-state":xe(c.state),"data-disabled":c.disabled?"":void 0,...i,ref:t,style:{pointerEvents:"none",...s.style}})})});he.displayName=me;var cs=s=>{const{control:t,checked:a,bubbles:n=!0,defaultChecked:i,...c}=s,l=u.useRef(null),h=ns(a),f=ke(t);u.useEffect(()=>{const m=l.current,o=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(o,"checked").set;if(h!==a&&r){const p=new Event("click",{bubbles:n});m.indeterminate=N(a),r.call(m,N(a)?!1:a),m.dispatchEvent(p)}},[h,a,n]);const x=u.useRef(N(a)?!1:a);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i??x.current,...c,tabIndex:-1,ref:l,style:{...s.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function N(s){return s==="indeterminate"}function xe(s){return N(s)?"indeterminate":s?"checked":"unchecked"}var fe=ue,ls=he;const pe=u.forwardRef(({className:s,...t},a)=>e.jsx(fe,{ref:a,className:S("peer h-6 w-6 shrink-0 rounded-sm border border-grey ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(ls,{className:S("flex items-center justify-center text-current"),children:e.jsx(we,{className:"h-6 w-6"})})}));pe.displayName=fe.displayName;async function ge({itemId:s,accessToken:t}){return await z(X.checkItem(s),"POST",void 0,{accessToken:t})}function ds(){const s=U(),{getToken:t}=P();return G({mutationKey:y.checkItem,mutationFn:async a=>{const n=await t({template:"1_HOUR"}).then(i=>i?.toString());return ge({itemId:a,accessToken:n})},onMutate:async a=>{await s.cancelQueries(y.latestGrocerylistByUserId);const n=s.getQueryData(y.latestGrocerylistByUserId);return n&&n.items&&s.setQueryData(y.latestGrocerylistByUserId,{...n,items:n.items.map(i=>i.item_id===a?{...i,check:!i.check}:i)}),{prev:n}},onSuccess:()=>{s.invalidateQueries([...y.latestGrocerylistByUserId,...y.latestGrocerylistByHouseholdId])}})}function us(){const s=U(),{getToken:t}=P();return G({mutationKey:y.checkItem,mutationFn:async a=>{const n=await t({template:"1_HOUR"}).then(i=>i?.toString());return ge({itemId:a,accessToken:n})},onMutate:async a=>{await s.cancelQueries(y.latestGrocerylistByHouseholdId);const n=s.getQueryData(y.latestGrocerylistByHouseholdId);return n&&n.items&&s.setQueryData(y.latestGrocerylistByHouseholdId,{...n,items:n.items.map(i=>i.item_id===a?{...i,check:!i.check}:i)}),{prev:n}},onSuccess:()=>{s.invalidateQueries([...y.latestGrocerylistByUserId,...y.latestGrocerylistByHouseholdId])}})}E.object({household:E.boolean(),menu:E.boolean()});async function ms({data:s,accessToken:t}){return await z(X.createList(),"POST",s,{accessToken:t})}function hs(){const s=U(),{getToken:t}=P();return G({mutationKey:y.createList,mutationFn:async a=>{const n=await t({template:"1_HOUR"}).then(i=>i?.toString());return ms({data:a,accessToken:n})},onSuccess:()=>{s.invalidateQueries([...y.latestGrocerylistByUserId,...y.latestGrocerylistByHouseholdId])}})}var O={};function $({id:s,items:t,onCheckOrUncheckItem:a,categories:n,isLoading:i}){const[c,l]=u.useState(""),[h,f]=u.useState(t),[x,m]=u.useState(null),o=R(),d=u.useMemo(()=>{const r=h?.reduce((p,g)=>(p[g.name]=(p[g.name]||0)+1,p),{});return h?.reduce((p,g)=>(p.some(k=>k.name===g.name)||p.push({...g,quantity:r[g.name]}),p),[])},[h,t]);return u.useEffect(()=>{t&&Array.isArray(t)&&f(t)},[t]),e.jsx("div",{className:"bg-slate-100 md:bg-white",children:e.jsxs(Me,{className:"bg-background md:bg-white px-3 py-3 rounded-b-sm h-fit md:rounded-lg",children:[d?.length?e.jsx("div",{className:"bg-white rounded-lg border-slate-200 border-[1px] p-3 mb-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:e.jsx(Ae,{placeholder:"Search items...",value:c,onChange:r=>l(r.target.value)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center pl-2 rounded-md gap-1 ${x?"border-[1px] border-slate-200":""}`,children:[n.find(r=>r.id===x)?.name,e.jsxs(Ce,{children:[e.jsx(Ie,{children:e.jsx("div",{children:e.jsx(Qe,{})})}),e.jsx(Te,{className:"px-2",align:"end",children:n.map(r=>e.jsx(Se,{className:"p-2",children:e.jsx("div",{className:"flex gap-1 hover:bg-gray-50 w-full",onClick:()=>m(r.id),children:r.name})},r.id))})]})]}),e.jsx(b,{onClick:()=>{l(""),m(null)},variant:"ghost",disabled:!x,children:e.jsx(Ke,{})})]})]})}):null,e.jsxs("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[!d?.length&&e.jsxs("div",{className:"flex flex-col gap-2 justify-center items-center bg-white rounded-lg p-3 md:p-4 md:rounded-xl col-span-2",children:[e.jsx("span",{className:"text-center text-muted-foreground",children:"You have no items in your current list."}),e.jsx(b,{onClick:()=>{s&&o({to:`/lists/${s}`})},className:"mt-2",variant:"outline",children:"Add items"})]}),d&&d.filter(r=>x!==null?r.category_id===x:!0).filter(r=>r.name.toLowerCase().includes(c.toLowerCase())).map(r=>e.jsx(L,{children:e.jsxs(_,{className:"flex items-center justify-between p-4 gap-2",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:e.jsx(pe,{id:r.item_id,checked:r.check,onCheckedChange:()=>a(r.item_id),className:"w-6 h-6 border-2 border-primary"})}),e.jsx("label",{htmlFor:r.item_id,className:`flex-grow text-base font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${r.check?"line-through text-muted-foreground":""}`,children:r.name}),r.quantity>1&&e.jsxs("span",{className:"text-md font-semibold text-muted-foreground",children:["x",r.quantity]})]})},r.item_id)),i?e.jsx(e.Fragment,{children:[...Array(3)].map((r,p)=>e.jsx(L,{children:e.jsx(_,{className:"p-6 px-7",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"h-6 w-6 rounded-sm"}),e.jsx(v,{className:"h-6 w-24"})]}),e.jsx(v,{className:"h-6 w-12"})]})})},p))}):null]})]})})}const ye=({children:s})=>e.jsx(L,{className:"w-full p-4 md:rounded-lg h-fit md:mt-3",children:e.jsx(_,{className:"w-full md:p-0 rounded-lg",children:s})});function xs({list:s}){const t=R();return e.jsxs(ye,{children:[e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("h3",{className:"text-md md:text-lg font-semibold",children:"My Shopping List"}),s?.id&&e.jsxs(b,{variant:"outline",onClick:()=>t({to:`/lists/${s.id}`}),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Edit"]})]}),s.items?.length?e.jsxs("p",{className:"text-sm",children:["Total Items: ",s.items?.length??"0"]}):null,s.items?.length?e.jsxs("p",{className:"text-sm",children:["Checked Items: ",s.items?.filter(a=>a.check)?.length??"0"]}):null]})}function fs({list:s}){const t=R();return e.jsxs(ye,{children:[e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("h3",{className:"text-md md:text-lg font-semibold",children:"My Household Shopping List"}),s?.id&&e.jsxs(b,{variant:"outline",onClick:()=>t({to:`/lists/${s.id}`}),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Edit"]})]}),s.items?.length?e.jsxs("p",{className:"text-sm",children:["Total Items: ",s.items?.length??"0"]}):null,s.items?.length?e.jsxs("p",{className:"text-sm",children:["Checked Items: ",s.items?.filter(a=>a.check)?.length??"0"]}):null]})}function ps(){const s=R(),[t,a]=u.useState(!1),[n,i]=u.useState("type"),[c,l]=u.useState(null),h=hs(),{toast:f}=ze(),{data:x}=Xe(),m=async r=>{if(!c)return;a(!0);const p={household:r==="household",menu:c==="mealplan"},g=await h.mutateAsync(p);if(!g.ok||!g.data){f({variant:"destructive",title:"Error",description:"Something went wrong creating the list."}),a(!1);return}const k={shopping:{me:`/lists/${g.data.data}`,household:`/lists/${g.data.data}`},mealplan:{me:"/lists/mealplan/new",household:"/list/mealplan/new?householdId=id"}};s({to:`${k[c][r]}`})},o=()=>{i("type"),l(null)},d="flex-1 h-16 text-lg transition-all duration-200 ease-in-out hover:bg-primary/10 hover:border-primary hover:border-2 active:bg-primary/20 active:scale-95";return e.jsxs(Pe,{onOpenChange:r=>!r&&o(),children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(b,{className:`fixed bottom-6 right-6 md:static md:w-auto md:h-auto md:rounded-md
                     w-16 h-16 rounded-full bg-primary text-primary-foreground shadow-lg md:shadow-none
                     hover:bg-primary/90 transition-all duration-200 ease-in-out
                     flex items-center justify-center z-50`,children:[e.jsx("span",{className:"text-3xl md:hidden",children:"+"}),e.jsx("span",{className:"hidden md:inline",children:"Create List"})]})}),e.jsxs(Ue,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(Fe,{children:[e.jsx(He,{className:"text-center mb-4",children:"Create a New List"}),!t&&e.jsx(Be,{className:"text-center",children:n==="type"?"Select the type of list you want to create.":"Choose who this list is for."})]}),t&&e.jsxs("div",{className:"flex flex-col gap-2 justify-center items-center",children:[e.jsx(De,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Creating new list..."})]}),!t&&e.jsxs(e.Fragment,{children:[n==="type"?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(b,{onClick:()=>{l("shopping"),i("scope")},className:d,variant:"outline",children:[e.jsx(We,{className:"mr-2 h-6 w-6"}),"Shopping List"]}),e.jsxs(b,{onClick:()=>{l("mealplan"),i("scope")},className:d,variant:"outline",disabled:O.NEXT_PUBLIC_FLAG_FEATURE_MEALPLANS!=="true",children:[e.jsx(Ye,{className:"mr-2 h-6 w-6"}),"Mealplan List ",O.NEXT_PUBLIC_FLAG_FEATURE_MEALPLANS!=="true"&&"(Coming Soon)"]})]}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(b,{onClick:()=>m("me"),className:d,variant:"outline",children:[e.jsx(Je,{className:"mr-2 h-6 w-6"}),"For Me"]}),x?.householdId&&e.jsxs(b,{onClick:()=>m("household"),className:d,variant:"outline",children:[e.jsx(Ze,{className:"mr-2 h-6 w-6"}),"For Household"]})]}),n==="scope"?e.jsx(b,{onClick:()=>i("type"),variant:"outline",className:"mt-4",children:"Back"}):e.jsx(Oe,{className:"w-full mt-4",children:e.jsx(b,{variant:"outline",className:"w-full",children:"Cancel"})})]})]})]})}function gs(){const{data:s,isFetching:t}=$e({initialData:null}),{data:a,isLoading:n}=qe({initialData:null}),{data:i}=Ve(),c=ds(),l=us(),h=o=>{const d=s.items.find(r=>r.item_id===o);for(const r of s.items)r.item_id!==o&&r.name===d?.name&&c.mutateAsync(r.item_id)},f=o=>{const d=a.items.find(r=>r.item_id===o);for(const r of a.items)r.item_id!==o&&r.name===d?.name&&c.mutateAsync(r.item_id)},x=o=>{c.mutateAsync(o),h(o)},m=o=>{l.mutateAsync(o),f(o)};return t&&!s?e.jsxs("div",{className:"container mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-x-2",children:[e.jsx(v,{className:"h-10 w-32 inline-block"}),e.jsx(v,{className:"h-10 w-40 inline-block"})]}),e.jsx(v,{className:"h-10 w-24"})]}),e.jsx(L,{children:e.jsxs(Ee,{children:[e.jsx(v,{className:"h-6 w-40 mb-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"h-4 w-48"}),e.jsx(v,{className:"h-4 w-32"}),e.jsx(v,{className:"h-4 w-40"})]})]})}),e.jsx(v,{className:"h-10 w-full"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[...Array(5)].map((o,d)=>e.jsx(L,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"h-4 w-4 rounded-sm"}),e.jsx(v,{className:"h-4 w-24"})]}),e.jsx(v,{className:"h-4 w-8"})]})})},d))})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(as,{defaultValue:"my",className:"w-full",children:[e.jsxs("div",{className:"w-full flex justify-between md:px-3 md:mt-3",children:[e.jsxs(de,{className:"grid w-full md:w-1/2 grid-cols-2",children:[e.jsx(M,{value:"my",children:"My Shopping List"}),a&&e.jsx(M,{value:"household",children:"Household Shopping List"})]}),e.jsx(ps,{})]}),e.jsxs("div",{className:"lg:pt-2",children:[e.jsx(A,{value:"my",children:e.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-1 md:gap-4",children:[e.jsx("div",{className:"px-3",children:e.jsx(xs,{list:s})}),e.jsx($,{id:s?.id,items:s?.items,onCheckOrUncheckItem:x,categories:i??[],isLoading:t})]})}),a&&e.jsx(A,{value:"household",children:e.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-1 md:gap-4",children:[e.jsx("div",{className:"px-3",children:e.jsx(fs,{list:a})}),e.jsx($,{id:a?.id,items:a?.items,onCheckOrUncheckItem:m,categories:i??[],isLoading:n})]})})]})]})})}const Us=()=>e.jsx("div",{className:"w-full min-h-[50vh]",children:e.jsx(gs,{})});export{Us as component};
