import{u as Q,r as y,j as e,o as Z,l as ee,R as te}from"./client-oEds41LK.js";import{c as W,B as b}from"./button-D2Gc-Tkd.js";import{S as A,C as $,b as B}from"./card-BSQouIYW.js";import{l as z,q as H,t as ae,k as p,O as ne,u as U}from"./getAllCategories-BHeGl718.js";import{_ as se,c as R,b as D,v as re,d as q,g as ie,e as oe,f as le,S as ce,h as de,a as ue,u as me,N as pe,T as he,P as E,i as ge}from"./NewIngredientForm-DfxmEMcr.js";import{u as fe,D as xe,b as ve,c as ye,d as Ne}from"./input-DpMdAE7i.js";import{a as K,u as Ce}from"./useCategories-B1B_UBf3.js";import{S as P}from"./skeleton-B0vMIt_L.js";import"./utils-B7BGwIMI.js";import"./mutation-BZFfKvOs.js";import"./floating-ui.dom-AxQjRnNf.js";import"./getAllIngredients-Bz8TcYMr.js";import"./index.esm-ZVTjRAfO.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=W("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=W("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);async function be(a,n){return await z(H.getGrocerylistById(n),"GET",void 0,{accessToken:a})}function Oe({id:a}){const{getToken:n}=Q(),i=n({template:"1_HOUR"}).then(r=>r?.toString());return ae({queryKey:p.getGrocerylistById(a),queryFn:async()=>{const r=await be(await i,a);return r.data?r.data:null},enabled:!!i,staleTime:ne})}async function Se({id:a,accessToken:n}){return await z(H.deleteItem(a),"DELETE",void 0,{accessToken:n})}function Ie(a){const n=U(),{getToken:i}=Q();return K(),fe({mutationKey:["delete-item"],mutationFn:async r=>{const s=await i({template:"1_HOUR"}).then(l=>l?.toString());return Se({id:r,accessToken:s})},onMutate:async r=>{await n.cancelQueries([...p.latestGrocerylistByUserId,...p.latestGrocerylistByHouseholdId,...p.getGrocerylistById(a)]);const s=await n.getQueryData(p.getGrocerylistById(a));return n.setQueryData(p.getGrocerylistById(a),{...s,items:s.items.filter(l=>l.item_id!==r)}),{prev:s}},onSuccess:()=>{n.invalidateQueries([...p.latestGrocerylistByUserId,...p.latestGrocerylistByHouseholdId,...p.getGrocerylistById(a)])}})}var Le=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],F=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,s=String(n).toLowerCase(),l=String(r.getOptionValue(i)).toLowerCase(),h=String(r.getOptionLabel(i)).toLowerCase();return l===s||h===s},V={formatCreateLabel:function(n){return'Create "'.concat(n,'"')},isValidNewOption:function(n,i,r,s){return!(!n||i.some(function(l){return F(n,l,s)})||r.some(function(l){return F(n,l,s)}))},getNewOptionData:function(n,i){return{label:i,value:n,__isNew__:!0}}};function _e(a){var n=a.allowCreateWhileLoading,i=n===void 0?!1:n,r=a.createOptionPosition,s=r===void 0?"last":r,l=a.formatCreateLabel,h=l===void 0?V.formatCreateLabel:l,O=a.isValidNewOption,S=O===void 0?V.isValidNewOption:O,j=a.getNewOptionData,x=j===void 0?V.getNewOptionData:j,g=a.onCreateOption,u=a.options,f=u===void 0?[]:u,v=a.onChange,d=se(a,Le),N=d.getOptionValue,I=N===void 0?ie:N,L=d.getOptionLabel,_=L===void 0?oe:L,m=d.inputValue,t=d.isLoading,o=d.isMulti,c=d.value,k=d.name,C=y.useMemo(function(){return S(m,R(c),f,{getOptionValue:I,getOptionLabel:_})?x(m,h(m)):void 0},[h,x,_,I,m,S,f,c]),Y=y.useMemo(function(){return(i||!t)&&C?s==="first"?[C].concat(D(f)):[].concat(D(f),[C]):f},[i,s,t,C,f]),J=y.useCallback(function(w,T){if(T.action!=="select-option")return v(w,T);var M=Array.isArray(w)?w:[w];if(M[M.length-1]===C){if(g)g(m);else{var G=x(m,m),X={action:"create-option",name:k,option:G};v(re(o,[].concat(D(R(c)),[G]),G),X)}return}v(w,T)},[x,m,o,k,C,g,v,c]);return q(q({},d),{},{options:Y,onChange:J})}var ke=y.forwardRef(function(a,n){var i=le(a),r=_e(i);return y.createElement(ce,de({ref:n},r))}),Te=ke;const Ge=({options:a,onSelect:n,placeholder:i,onFocus:r})=>e.jsx(ge,{options:a.map(s=>({value:s.id,label:s.name})),placeholder:"Search ingredients...",onChange:s=>{const l=a.find(h=>h.id===s.value);s&&s.value&&l&&n(l)},onFocus:r,className:"my-react-select-container",classNamePrefix:"my-react-select"});function $e(){const{listId:a}=Z.useParams(),n=ee(),[i,r]=te.useState(!1),{data:s,isFetching:l}=Oe({id:a}),{data:h}=Ce(),O=U(),S=ue(a),j=Ie(a),[x,g]=y.useState(""),{data:u,isFetching:f}=me(),{toast:v}=K(),d=y.useMemo(()=>{if(!s)return[];const t=s.items.reduce((o,c)=>(o[c.name]=(o[c.name]||0)+1,o),{});return s.items.reduce((o,c)=>(o.some(k=>k.name===c.name)||o.push({...c,quantity:t[c.name]}),o),[])},[s]),N=async t=>{if(!t){v({variant:"destructive",title:"Error",description:"Ingredient Id not found."});return}const o=u?.find(c=>c.id===t);if(!o){v({variant:"destructive",title:"Error",description:"Ingredient not found."});return}await S.mutateAsync({...o,ingredientId:o.id})},I=async t=>{j.mutate(t)},L=t=>{if(s)for(const o of s.items)o.ingredient_id===t&&j.mutate(o.item_id)},_=t=>{r(!0),g(t)},m=()=>{const t=document.querySelector(".page");t&&window.scrollTo({top:t.offsetTop,behavior:"smooth"})};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{open:i,onOpenChange:r,children:e.jsxs(ve,{className:"sm:max-w-[425px] bg-white",children:[e.jsx(ye,{children:e.jsx(Ne,{className:"text-center mb-4",children:"New Ingredient"})}),e.jsx(pe,{defaultValue:x,categories:h?.length?h:[],onClose:()=>r(!1),onInvalidate:()=>{O.invalidateQueries(p.ingredients)}})]})}),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs(b,{variant:"outline",onClick:()=>n({to:"/lists"}),className:"mb-4",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 min-h-[100vh]",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Current Grocery List"}),e.jsx("div",{className:"md:hidden mb-4 page",children:e.jsx(Ge,{options:u&&u.length?u:[],onSelect:t=>N(t.id),placeholder:"Search and add ingredients...",onFocus:m})}),e.jsx(A,{className:"min-h-[75vh]",children:e.jsxs("div",{className:"space-y-2",children:[!d.length&&!f&&e.jsx("span",{className:"text-center text-muted-foreground",children:"No items in list."}),l&&!d.length?e.jsx(e.Fragment,{children:[...Array(3)].map((t,o)=>e.jsx($,{children:e.jsx(B,{className:"p-6 px-7",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"h-6 w-6 rounded-sm"}),e.jsx(P,{className:"h-6 w-24"})]}),e.jsx(P,{className:"h-6 w-12"})]})})},o))}):null,d.map(t=>e.jsx($,{children:e.jsxs(B,{className:"flex items-center justify-between p-4",children:[e.jsx("span",{className:"flex-grow",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.quantity>1?e.jsx(b,{variant:"outline",size:"icon",onClick:()=>I(t.item_id),children:e.jsx(we,{className:"h-4 w-4"})}):e.jsx(b,{variant:"outline",size:"icon",onClick:()=>L(t.ingredient_id),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center",children:t.quantity||0}),e.jsx(b,{variant:"outline",size:"icon",onClick:()=>{N(t.ingredient_id)},children:e.jsx(E,{className:"h-4 w-4"})})]})]})},t.item_id))]})})]}),e.jsxs("div",{className:"hidden md:block w-full md:w-1/2",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Available Items"}),e.jsx("div",{className:"mb-4 relative pr-4",children:e.jsx(Te,{isClearable:!0,options:u?.map(t=>({value:t.id,label:t.name})),placeholder:"Search for an item...",onCreateOption:_,onChange:t=>{g(t?t.label.toString():"")},onInputChange:t=>g(t),menuShouldScrollIntoView:!0,className:"my-react-select-container",classNamePrefix:"my-react-select",styles:{input:t=>({...t,fontSize:"16px"}),control:t=>({...t,borderRadius:8,height:44}),indicatorSeparator:t=>({...t,display:"none"}),menu:t=>({...t,borderRadius:8})}})}),e.jsx(A,{className:"md:h-[calc(100vh-250px)] min-h-75vh]",children:e.jsx("div",{className:"space-y-2 pr-4",children:u&&u.length?u.filter(t=>t.name.toLowerCase().includes(x.toLowerCase())).map(t=>e.jsx($,{children:e.jsxs(B,{className:"flex items-center justify-between p-4",children:[e.jsx("span",{className:"flex-grow",children:t.name}),e.jsx(b,{variant:"outline",size:"icon",onClick:()=>N(t.id),children:e.jsx(E,{className:"h-4 w-4"})})]})},t.id)):null})})]})]})]})]})}const He=()=>e.jsx($e,{});export{He as component};
